@*
* Copyright 2016 HM Revenue & Customs
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@

@(calculationResponse:CalculationResponse, sameTaxYear:Boolean, stillInScheme:Boolean)(implicit request: Request[_])

@import play.i18n._
@import org.joda.time.LocalDate
@import views.helpers.GmpDateFormatter._
@import uk.gov.hmrc.time.TaxYearResolver

@header = @{
    if(calculationResponse.calcType == CalculationType.SURVIVOR.toInt && calculationResponse.revaluationDate.isDefined){
        Messages.get("gmp.results.survivor.revaluation.header", formatDate(calculationResponse.revaluationDate.get))
    }else if(calculationResponse.calcType == CalculationType.SURVIVOR.toInt && calculationResponse.dateOfDeath.isDefined){
        Messages.get("gmp.results.survivor.header", formatDate(calculationResponse.dateOfDeath.get))
    }else if(calculationResponse.calcType == CalculationType.SURVIVOR.toInt){
        Messages.get("gmp.results.survivor.header")
    }else if(calculationResponse.calcType == CalculationType.SPA.toInt && calculationResponse.spaDate.isDefined) {
        Messages.get("gmp.spa.header", formatDate(calculationResponse.spaDate.get))
    }else if(calculationResponse.calcType == CalculationType.PAYABLE_AGE.toInt && calculationResponse.payableAgeDate.isDefined) {
        Messages.get("gmp.payable_age.header", formatDate(calculationResponse.payableAgeDate.get))
    }else if(calculationResponse.revaluationDate.isEmpty || calculationResponse.revaluationUnsuccessful || sameTaxYear){
       Messages.get("gmp.leaving.scheme.header", formatDate(calculationResponse.leavingDate))
    }else {
        if(calculationResponse.calculationPeriods.length <= 1)
            Messages.get("gmp.leaving.revalued.header", formatDate(calculationResponse.leavingDate), Messages.get(s"gmp.revaluation_rate.type_${calculationResponse.calculationPeriods.head.revaluationRate}"))
        else
            Messages.get("gmp.leaving.revalued.header", formatDate(calculationResponse.leavingDate), Messages.get(s"gmp.revaluation_rate.type_${calculationResponse.revaluationRate.get}"))
    }
}

@subheader = @{

  if (calculationResponse.calcType == CalculationType.DOL.toInt && calculationResponse.calculationPeriods.length > 1) {
        Messages.get("gmp.notrevalued.multi.subheader")
  } else if (calculationResponse.calcType == CalculationType.DOL.toInt ||
            (calculationResponse.calcType == CalculationType.REVALUATION.toInt && !stillInScheme && (calculationResponse.revaluationUnsuccessful || sameTaxYear))) {
                Messages.get("gmp.notrevalued.subheader")
  } else if(calculationResponse.calcType == CalculationType.SURVIVOR.toInt &&
            calculationResponse.calculationPeriods.head.inflationProofBeyondDod == Some(0) &&
            calculationResponse.dodInSameTaxYearAsRevaluationDate) {
                Messages.get("gmp.no_inflation.subheader")
  } else ""
}


@if(!calculationResponse.hasErrors) {
  <div class="grid">

    <div class="grid-2-3">
        <div class="confirmation">
          <h1 class="heading-large">
            <image src='@routes.AssetsController.at("images/tick.png")' alt=""/>
            @Messages.get("gmp.results.banner")
          </h1>
        </div>
    </div>

    <div class="grid-1-3 print-style top-blue-border">
      <ul>
        <li>
          <a href="javascript:window.print();" id="print-link" data-journey-click="gmp:click:print">@Messages.get("gmp.print")</a>
        </li>
      </ul>
    </div>

  </div>
}

<div class="grid">

  <div class="grid-2-3">
    <h2 id="results-header">@header</h2>

    @if(!subheader.isEmpty) {
      <div id="subheader" class="panel-indent">@subheader</div>
    }
  </div>

</div>
