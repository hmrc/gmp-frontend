@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.ApplicationConfig

@(calculationResponse:CalculationResponse)(implicit messages: Messages, applicationConfig: ApplicationConfig)

@import org.joda.time.LocalDate

<table class="govuk-table" id="periods">
    <caption class="govuk-table__caption govuk-table__caption--m hidden">@Messages("gmp.results.table_caption")</caption>
    <thead class="govuk-table__head">
        <tr class="govuk-table__row" id="table-column-names">
            <th scope="col" class="govuk-table__header">@Messages("gmp.table.period")</th>
            <th scope="col" class="govuk-table__header"><span class="hidden">hidden text for empty th</span></th>
            <th scope="col" class="govuk-table__header"><span class="hidden">hidden text for empty th</span></th>
            <th scope="col" class="govuk-table__header"><span class="hidden">hidden text for empty th</span></th>
            <th scope="col" class="govuk-table__header" id="per-week">@Messages("gmp.per.week")</th>
            <th scope="col" class="govuk-table__header" id ="post-1988">@Messages("gmp.post.1988")</th>
            @if(calculationResponse.dualCalc) {
                <th scope="col" class="govuk-table__header" id="true-table-column-header">@Messages("gmp.true")</th>
                <th scope="col" class="govuk-table__header" id="opposite-table-column-header">@Messages("gmp.opposite")</th>
            }
            @if(!calculationResponse.revaluationDate.isEmpty && calculationResponse.revaluationRate == Some("0")) {
                <th scope="col" class="govuk-table__header" id="hmrc-held-rate">@Messages("gmp.rate_hmrc_holds")</th>
            }
        </tr>
    </thead>
    <tbody class="govuk-table__body">
    @for((period, count) <- calculationResponse.calculationPeriods.zipWithIndex){

    <tr class="govuk-table__row" @{if(period.errorCode> 0 )"class=error-row"}>
        <td class="govuk-table__cell" colspan="4">
            <span class="bold-xsmall" id="from-date-@count">@Messages("gmp.date_from")</span><hr class="govuk-section-break" aria-hidden = true/> @{ new LocalDate(period.startDate.get).toString("dd MMM yyyy") } <hr class="govuk-section-break" aria-hidden = true>
            <span class="bold-xsmall" id="to-date-@count">@Messages("gmp.date_To")</span><hr class="govuk-section-break" aria-hidden = true/> @{ new LocalDate(period.endDate).toString("dd MMM yyyy") }
        </td>
        @if(period.errorCode == 0) {
            <td class="govuk-table__cell" id="gmp-total-@count">
                <span class="bold-small">£@{ period.gmpTotal }</span>
            </td>
            <td class="govuk-table__cell" id="post-88-@count">
                <span class="bold-small">£@{ period.post88GMPTotal }</span>
            </td>

            @if(calculationResponse.dualCalc) {
                <td class="govuk-table__cell"  id="true-@count">
                    <span class="bold-small">
                      @if(period.dualCalcPost90TrueTotal != Some("0.00")) {
                        £@{ period.dualCalcPost90TrueTotal }
                      } else {
                        --
                      }
                    </span>
                </td>
                <td class="govuk-table__cell" id="opposite-@count">
                    <span class="bold-small">
                      @if(period.dualCalcPost90OppositeTotal != Some("0.00")) {
                        £@{ period.dualCalcPost90OppositeTotal }
                      } else {
                        --
                      }
                    </span>
                </td>
            }
            @if(!calculationResponse.revaluationDate.isEmpty && calculationResponse.revaluationRate == Some("0")) {
                <td class="govuk-table__cell"  id="rate-@count">
                    <span class="bold-small">
                      @if(count == 0 && !period.endDate.isBefore(LocalDate.now)) {
                        --
                      } else {
                        @{ Messages(s"gmp.revaluation_rate.type_${period.revaluationRate}") }
                      }
                    </span>
                </td>
            }
        } else {
            <td id="error-@count" colspan="5" class="govuk-table__cell table-error-message"  >
                @if(applicationConfig.globalErrors.hasPath(s"${period.errorCode}.reason")){
                    <p class="govuk-body" id="reason-@count">@Messages(applicationConfig.globalErrors.getString(s"${period.errorCode}.reason"))</p>
                } else {
                    <p class="govuk-body" id="unavailable-@count">@Messages("gmp.unavailable")</p>
                }
            </td>
        }
    </tr>
    }
    </tbody>
</table>