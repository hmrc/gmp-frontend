@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.ApplicationConfig
@import views.html.helpers._
@import models.Leaving
@import views.ViewHelpers
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import uk.gov.hmrc.hmrcfrontend.views.Implicits.RichErrorSummary


@this(
        gmpMain: gmp_main,
        viewHelpers: ViewHelpers,
        govukRadios : GovukRadios,
        govukButton: GovukButton,
        govukDateInput: GovukDateInput,
        govukErrorMessage: GovukErrorMessage,
        govukErrorSummary: GovukErrorSummary)


@(dateOfLeavingForm: Form[models.Leaving],scenario: String)(implicit request: Request[_], messages: Messages, applicationConfig: ApplicationConfig)
@conditionalHtml = {
    @govukDateInput(DateInput(
        id = "leavingDate",
        namePrefix = Some("leavingDate"),
        hint = Some(Hint(
            content = Text(Messages("gmp.date.example"))
        )),
        fieldset = Some(Fieldset(
            legend = Some(Legend(
                content = Text(Messages("gmp.date.header_text")),
                classes = "govuk-fieldset__legend",
                isPageHeading = false
            ))
        ))
    ))
}

@implicitFormInstance = @{ Some(dateOfLeavingForm) }

@pageScripts = {
  <script type="text/javascript" src='@controllers.routes.AssetsController.at("javascripts/selection-buttons.js")'></script>
  <script type="text/javascript" src='@controllers.routes.AssetsController.at("javascripts/progressive-reveal.js")'></script>
  <script type="text/javascript" src='@controllers.routes.AssetsController.at("javascripts/leaving-date.js")'></script>
}

@heading = {
    @{scenario match {
    case CalculationType.DOL => Messages("gmp.leaving.dol.question")
    case CalculationType.SPA | CalculationType.PAYABLE_AGE | CalculationType.REVALUATION => Messages("gmp.other.dol.left.question")
    case CalculationType.SURVIVOR => Messages("gmp.survivor.dol.question")}
    }
}

@gmpMain(title = heading + Messages("service.title"), pageScripts = Some(pageScripts)) {

    @includes.back_link(Messages("gmp.bulk.problem.header"))

    @if(dateOfLeavingForm.errors.nonEmpty) {
        @govukErrorSummary(ErrorSummary().withFormErrorsAsText(dateOfLeavingForm))
    }
    @if(dateOfLeavingForm.hasGlobalErrors) {
        @dateOfLeavingForm.globalErrors.zipWithIndex.map { case (error, index) =>
        <span style="display: block" class="govuk-error-message" id="global-error-@index">@error.message</span>
        }
    }

    @viewHelpers.form(action = routes.DateOfLeavingController.post) {
                @if(scenario == CalculationType.DOL) {
                        @govukRadios(Radios(
                            fieldset = Some(Fieldset(
                                legend = Some(Legend(
                                    content = Text(Messages("gmp.leaving.dol.question")),
                                    classes = "govuk-fieldset__legend--l",
                                    isPageHeading = true
                                ))
                            )),
                            idPrefix = Some("leaving"),
                            name = "leaving",
                            items = Seq(
                                RadioItem(
                                    content = Text(Messages("gmp.generic.yes")),
                                    value = Some(Leaving.YES_BEFORE)
                                ),
                                RadioItem(
                                    content = Text(Messages("gmp.generic.no")),
                                    value = Some(Leaving.YES_AFTER)
                                )
                            )
                        ))

                    } else { @if(scenario == CalculationType.SURVIVOR) {
                        @govukRadios(Radios(
                            fieldset = Some(Fieldset(
                                legend = Some(Legend(
                                    content = Text(Messages("gmp.survivor.dol.question")),
                                    classes = "govuk-fieldset__legend--l",
                                    isPageHeading = true
                                ))
                            )),
                            idPrefix = Some("leaving"),
                            name = "leaving",

                            items = Seq(
                                RadioItem(
                                    content = Text(Messages("gmp.dol.threequestions.no.survivor")),
                                    value = Some(Leaving.NO)
                                ),
                                RadioItem(
                                    content = Text(Messages("gmp.dol.threequestions.before2016")),
                                    value = Some(Leaving.YES_BEFORE)
                                ),
                                RadioItem(
                                    content = Text(Messages("gmp.dol.threequestions.after2016")),
                                    value = Some(Leaving.YES_AFTER),
                                    conditionalHtml = Some(conditionalHtml)
                                )
                            )
                        ))
                    } else {
                        @govukRadios(Radios(
                            fieldset = Some(Fieldset(
                                legend = Some(Legend(
                                    content = Text(Messages("gmp.other.dol.left.question")),
                                    classes = "govuk-fieldset__legend--l",
                                    isPageHeading = true
                                ))
                            )),
                            idPrefix = Some("leaving"),
                            name = "leaving",
                            items = Seq(
                                RadioItem(
                                    content = Text(Messages("gmp.dol.threequestions.no")),
                                    value = Some(Leaving.NO)
                                ),
                                RadioItem(
                                    content = Text(Messages("gmp.dol.threequestions.before2016")),
                                    value = Some(Leaving.YES_BEFORE)
                                ),
                                RadioItem(
                                    content = Text(Messages("gmp.dol.threequestions.after2016")),
                                    value = Some(Leaving.YES_AFTER),
                                    conditionalHtml = Some(conditionalHtml)
                                )
                            ),
                         ))
                        ))

                    }
                }

            </div>
            </div>

            <div>
                <hr class="govuk-section-break" aria-hidden = true/>
                @govukButton(Button(
                    content = Text(Messages("gmp.continue.button"))
                ))
@*              <button class="button" data-journey-click='@Messages("gmp.ga-track.button.click"):@heading:@Messages("gmp.continue.button")'*@
@*                      type="submit" id="submit-button">@Messages("gmp.continue.button")</button>*@
@*            *@
            </div>
        }
}
